<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaRevival - Admin Panel</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000 url('https://www.themebeta.com/thumbnail/728/1113207/files/chrome/images/201607/08/a7e9a6aa6caf76e019e27cacd48ef143.webp') fixed center/cover;
            color: white;
            font-family: Arial, sans-serif;
            min-height: 100vh;
        }
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #111;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
            border-bottom: 1px solid #333;
        }
        .close-btn {
            font-size: 28px;
            cursor: pointer;
            color: #ccc;
        }
        .close-btn:hover { color: white; }

        /* Smaller sidebar with rounded corners */
        .sidebar {
            position: fixed;
            left: 0;
            top: 60px;
            bottom: 0;
            width: 200px;
            background: rgba(20,20,20,0.95);
            padding: 20px 15px;
            border-right: 1px solid #333;
            border-top-right-radius: 16px;
            border-bottom-right-radius: 16px;
            backdrop-filter: blur(8px);
            overflow-y: auto;
        }
        .sidebar button {
            display: block;
            width: 100%;
            padding: 14px;
            margin: 8px 0;
            background: #333;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
            border-radius: 12px;
            transition: background 0.2s;
            touch-action: manipulation; /* Better mobile support */
        }
        .sidebar button:hover {
            background: #555;
        }

        .main {
            margin-left: 220px;
            margin-top: 80px;
            padding: 40px;
            min-height: calc(100vh - 80px);
            overflow-y: auto;
        }

        input, textarea {
            padding: 12px;
            width: 320px;
            margin: 10px 0;
            background: #222;
            color: white;
            border: 1px solid #444;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        button.action {
            background: #FF6A00;
            padding: 14px 20px;
            margin-top: 20px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            touch-action: manipulation;
        }
        button.danger {
            background: #FF0000;
        }
        button.remove {
            background: #CC0000;
        }
        button.secondary {
            background: #0066FF;
        }

        #result {
            margin-top: 30px;
            font-size: 20px;
            padding: 20px;
            background: rgba(0,255,0,0.2);
            border-radius: 12px;
            text-align: center;
        }

        .section {
            display: none;
        }
        .section.active {
            display: block;
        }

        /* Upload form layout - simple stacked */
        .upload-form {
            max-width: 600px;
        }

        /* Catalog Management Styles - Straight line separator */
        .catalog-list {
            margin-top: 20px;
            max-height: 60vh;
            overflow-y: auto;
            padding: 10px 0;
        }
        .catalog-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid #444;
        }
        .catalog-item:last-child {
            border-bottom: none;
        }
        .catalog-item img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            background: #333;
            border-radius: 6px;
        }
        .catalog-item-info {
            flex-grow: 1;
        }
        .catalog-item-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .catalog-item-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .catalog-item-controls input {
            width: 100px;
        }
        .status-onsale { color: #00ff00; font-weight: bold; }
        .status-offsale { color: #ff6666; font-weight: bold; }

        /* Mobile improvements */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                border-radius: 0;
                border-right: none;
            }
            .main {
                margin-left: 0;
                margin-top: 60px;
            }
            .sidebar button {
                padding: 16px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h2>Admin Panel</h2>
        <div class="close-btn" onclick="window.location.href='home.html'">✕</div>
    </div>

    <div class="sidebar">
        <button onclick="showSection('verify')">Make Verified</button>
        <button onclick="showSection('unverify')">Remove Verified</button>
        <button onclick="showSection('ban')">Ban / Terminate</button>
        <button onclick="showSection('delete')">Delete User</button>
        <button onclick="showSection('robux')">Add Robux</button>
        <button onclick="showSection('removerobux')">Remove Robux</button>
        <button onclick="showSection('tix')">Add Tix</button>
        <button onclick="showSection('removetix')">Remove Tix</button>
        <button onclick="showSection('additem')">Upload Item</button>
        <button onclick="showSection('managecatalog')">Manage Catalog</button>
    </div>

    <div class="main">
        <!-- Make Verified -->
        <div id="verify" class="section active">
            <h2>Make Verified</h2>
            <input id="verifyUser" placeholder="Username">
            <button class="action" onclick="makeVerified()">Make Verified</button>
        </div>

        <!-- Remove Verified -->
        <div id="unverify" class="section">
            <h2>Remove Verified</h2>
            <input id="unverifyUser" placeholder="Username">
            <button class="action" onclick="removeVerified()">Remove Verified</button>
        </div>

        <!-- Ban / Terminate -->
        <div id="ban" class="section">
            <h2>Ban / Terminate User (Permanent)</h2>
            <input id="banUser" placeholder="Username">
            <button class="action danger" onclick="banUser()">Ban User</button>
            <p style="font-size:14px; color:#aaa;">Banned users cannot log in ever again.</p>
        </div>

        <!-- Delete User -->
        <div id="delete" class="section">
            <h2>Delete User Account</h2>
            <input id="deleteUser" placeholder="Username">
            <button class="action danger" onclick="deleteUser()">Delete Account</button>
            <p style="font-size:14px; color:#aaa;">This completely removes the account. They can re-register with the same name.</p>
        </div>

        <!-- Add Robux -->
        <div id="robux" class="section">
            <h2>Add Robux</h2>
            <input id="robuxUser" placeholder="Username">
            <input id="robuxAmount" type="number" placeholder="Amount">
            <button class="action" onclick="giveRobux()">Give Robux</button>
        </div>

        <!-- Remove Robux -->
        <div id="removerobux" class="section">
            <h2>Remove Robux</h2>
            <input id="removeRobuxUser" placeholder="Username">
            <input id="removeRobuxAmount" type="number" placeholder="Amount">
            <button class="action remove" onclick="removeRobux()">Remove Robux</button>
        </div>

        <!-- Add Tix -->
        <div id="tix" class="section">
            <h2>Add Tix</h2>
            <input id="tixUser" placeholder="Username">
            <input id="tixAmount" type="number" placeholder="Amount">
            <button class="action" onclick="giveTix()">Give Tix</button>
        </div>

        <!-- Remove Tix -->
        <div id="removetix" class="section">
            <h2>Remove Tix</h2>
            <input id="removeTixUser" placeholder="Username">
            <input id="removeTixAmount" type="number" placeholder="Amount">
            <button class="action remove" onclick="removeTix()">Remove Tix</button>
        </div>

        <!-- Upload Item Section -->
        <div id="additem" class="section">
            <h2>Upload New Item to Catalog</h2>
            <div class="upload-form">
                <input id="itemName" placeholder="Item Name">
                <input id="itemImage" placeholder="Image URL (e.g. Roblox asset link)">
                <textarea id="itemDesc" placeholder="Item Description (optional)"></textarea>
                <input id="itemRobux" type="number" placeholder="Robux Price (0 = free)">
                <input id="itemTix" type="number" placeholder="Tix Price (optional)">
                <label>
                    <input type="checkbox" id="itemNew"> Mark as NEW
                </label>
                <br><br>
                <button class="action" onclick="addCatalogItem()">Upload Item</button>
            </div>
        </div>

        <!-- Manage Catalog Section -->
        <div id="managecatalog" class="section">
            <h2>Manage Catalog Items</h2>
            <div id="catalogList" class="catalog-list">
                <!-- Items loaded dynamically -->
            </div>
        </div>

        <p id="result"></p>
    </div>

    <script>
        const currentUser = localStorage.getItem('currentUser');
        const admins = ['TestUser', 'NovaRevival', 'tinypuurs'];
        if (!admins.includes(currentUser)) {
            alert('Access Denied! Admins only.');
            window.location.href = 'home.html';
        }

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('result').innerText = '';
            if (id === 'managecatalog') loadCatalogItems();
        }

        // === ALL ADMIN FUNCTIONS (now fully restored and working) ===
        function makeVerified() {
            const user = document.getElementById('verifyUser').value.trim();
            if (!user) return alert('Enter a username');
            let data = JSON.parse(localStorage.getItem(user) || '{}');
            data.verified = true;
            localStorage.setItem(user, JSON.stringify(data));
            document.getElementById('result').innerText = `${user} is now verified!`;
        }

        function removeVerified() {
            const user = document.getElementById('unverifyUser').value.trim();
            if (!user) return alert('Enter a username');
            let data = JSON.parse(localStorage.getItem(user) || '{}');
            delete data.verified;
            localStorage.setItem(user, JSON.stringify(data));
            document.getElementById('result').innerText = `${user}'s verified status removed!`;
        }

        function banUser() {
            const user = document.getElementById('banUser').value.trim();
            if (!user) return alert('Enter a username');
            if (confirm(`Permanently ban ${user}?`)) {
                let banned = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
                if (!banned.includes(user)) banned.push(user);
                localStorage.setItem('bannedUsers', JSON.stringify(banned));
                document.getElementById('result').innerText = `${user} has been permanently banned!`;
            }
        }

        function deleteUser() {
            const user = document.getElementById('deleteUser').value.trim();
            if (!user) return alert('Enter a username');
            if (confirm(`Delete ${user}'s account?`)) {
                localStorage.removeItem(user);
                let banned = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
                banned = banned.filter(u => u !== user);
                localStorage.setItem('bannedUsers', JSON.stringify(banned));
                document.getElementById('result').innerText = `${user}'s account has been deleted!`;
            }
        }

        function giveRobux() {
            const user = document.getElementById('robuxUser').value.trim();
            const amount = parseInt(document.getElementById('robuxAmount').value);
            if (!user || isNaN(amount) || amount <= 0) return alert('Invalid input');
            let data = JSON.parse(localStorage.getItem(user) || '{}');
            data.robux = (data.robux || 0) + amount;
            localStorage.setItem(user, JSON.stringify(data));
            document.getElementById('result').innerText = `Gave ${amount} Robux to ${user}!`;
        }

        function removeRobux() {
            const user = document.getElementById('removeRobuxUser').value.trim();
            const amount = parseInt(document.getElementById('removeRobuxAmount').value);
            if (!user || isNaN(amount) || amount <= 0) return alert('Invalid input');
            let data = JSON.parse(localStorage.getItem(user) || '{}');
            data.robux = Math.max(0, (data.robux || 0) - amount);
            localStorage.setItem(user, JSON.stringify(data));
            document.getElementById('result').innerText = `Removed ${amount} Robux from ${user}!`;
        }

        function giveTix() {
            const user = document.getElementById('tixUser').value.trim();
            const amount = parseInt(document.getElementById('tixAmount').value);
            if (!user || isNaN(amount) || amount <= 0) return alert('Invalid input');
            let data = JSON.parse(localStorage.getItem(user) || '{}');
            data.tix = (data.tix || 0) + amount;
            localStorage.setItem(user, JSON.stringify(data));
            document.getElementById('result').innerText = `Gave ${amount} Tix to ${user}!`;
        }

        function removeTix() {
            const user = document.getElementById('removeTixUser').value.trim();
            const amount = parseInt(document.getElementById('removeTixAmount').value);
            if (!user || isNaN(amount) || amount <= 0) return alert('Invalid input');
            let data = JSON.parse(localStorage.getItem(user) || '{}');
            data.tix = Math.max(0, (data.tix || 0) - amount);
            localStorage.setItem(user, JSON.stringify(data));
            document.getElementById('result').innerText = `Removed ${amount} Tix from ${user}!`;
        }

        function addCatalogItem() {
            const name = document.getElementById('itemName').value.trim();
            const image = document.getElementById('itemImage').value.trim();
            const desc = document.getElementById('itemDesc').value.trim() || 'No description provided.';
            const robux = parseInt(document.getElementById('itemRobux').value) || 0;
            const tix = parseInt(document.getElementById('itemTix').value) || 0;
            const isNew = document.getElementById('itemNew').checked;

            if (!name || !image) return alert('Name and Image URL are required!');

            const userData = JSON.parse(localStorage.getItem(currentUser) || '{}');
            const isVerified = userData.verified || false;

            let catalog = JSON.parse(localStorage.getItem('catalog') || '[]');
            const id = Date.now();

            catalog.push({
                id,
                name,
                image,
                creator: currentUser,
                verified: isVerified,
                description: desc,
                robuxPrice: robux,
                tixPrice: tix,
                onSale: true,
                isNew
            });

            localStorage.setItem('catalog', JSON.stringify(catalog));
            document.getElementById('result').innerText = `"${name}" uploaded to catalog!`;

            document.getElementById('itemName').value = '';
            document.getElementById('itemImage').value = '';
            document.getElementById('itemDesc').value = '';
            document.getElementById('itemRobux').value = '';
            document.getElementById('itemTix').value = '';
            document.getElementById('itemNew').checked = false;
        }

        function loadCatalogItems() {
            const list = document.getElementById('catalogList');
            list.innerHTML = '';
            const catalog = JSON.parse(localStorage.getItem('catalog') || '[]');

            if (catalog.length === 0) {
                list.innerHTML = '<p>No items in catalog yet.</p>';
                return;
            }

            catalog.forEach(item => {
                const verifiedMark = item.verified ? ' ✔️' : '';
                const div = document.createElement('div');
                div.className = 'catalog-item';
                div.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="catalog-item-info">
                        <div class="catalog-item-name">${item.name} ${item.isNew ? '<span style="color:red;">(NEW)</span>' : ''}</div>
                        <div>By: ${item.creator || 'Unknown'}${verifiedMark}</div>
                        <div>Status: <span class="${item.onSale ? 'status-onsale' : 'status-offsale'}">${item.onSale ? 'On Sale' : 'Offsale'}</span></div>
                        <div>Price: R$${item.robuxPrice} ${item.tixPrice > 0 ? ` | ${item.tixPrice} Tix` : ''}</div>
                    </div>
                    <div class="catalog-item-controls">
                        <input type="number" id="priceRobux_${item.id}" placeholder="Robux" value="${item.robuxPrice}">
                        <input type="number" id="priceTix_${item.id}" placeholder="Tix" value="${item.tixPrice}">
                        <button class="action secondary" onclick="updateItem(${item.id})">Update Price</button>
                        <button class="${item.onSale ? 'action remove' : 'action'}" onclick="toggleSale(${item.id})">
                            ${item.onSale ? 'Set Offsale' : 'Set On Sale'}
                        </button>
                        <button class="action danger" onclick="deleteCatalogItem(${item.id})">Delete</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function updateItem(id) {
            let catalog = JSON.parse(localStorage.getItem('catalog') || '[]');
            const item = catalog.find(i => i.id === id);
            if (!item) return;
            item.robuxPrice = parseInt(document.getElementById(`priceRobux_${id}`).value) || 0;
            item.tixPrice = parseInt(document.getElementById(`priceTix_${id}`).value) || 0;
            localStorage.setItem('catalog', JSON.stringify(catalog));
            document.getElementById('result').innerText = 'Item price updated!';
            loadCatalogItems();
        }

        function toggleSale(id) {
            let catalog = JSON.parse(localStorage.getItem('catalog') || '[]');
            const item = catalog.find(i => i.id === id);
            if (!item) return;
            item.onSale = !item.onSale;
            localStorage.setItem('catalog', JSON.stringify(catalog));
            document.getElementById('result').innerText = `Item now ${item.onSale ? 'On Sale' : 'Offsale'}!`;
            loadCatalogItems();
        }

        function deleteCatalogItem(id) {
            if (!confirm('Delete this item permanently?')) return;
            let catalog = JSON.parse(localStorage.getItem('catalog') || '[]');
            catalog = catalog.filter(i => i.id !== id);
            localStorage.setItem('catalog', JSON.stringify(catalog));
            document.getElementById('result').innerText = 'Item deleted!';
            loadCatalogItems();
        }

        // Ban check
        const bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
        if (bannedUsers.includes(currentUser)) {
            alert('Your account is permanently banned.');
            localStorage.clear();
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>